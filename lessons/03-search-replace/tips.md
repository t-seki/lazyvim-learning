# ヒントとテクニック

## よくある間違い

### 間違い1: 正規表現のエスケープ忘れ

**症状**: 期待した検索結果が得られない

**原因**: 特殊文字をエスケープしていない

**解決方法**:
```vim
" 間違い
/function.add    " .が任意の文字として解釈される

" 正しい
/function\.add   " .をリテラル文字として検索

" よくエスケープが必要な文字
. * [ ] ^ $ \ / ? + ( ) { }
```

### 間違い2: 置換での後方参照ミス

**症状**: 置換結果が予期しない形になる

**原因**: グループ化（\( \)）と後方参照（\1, \2）の対応が間違っている

**解決方法**:
```vim
" 間違い：グループ化なしで後方参照
:%s/function add/const \1/g

" 正しい：適切なグループ化
:%s/function \(add\)/const \1/g

" グループの順序確認
:%s/\(first\) \(second\)/\2 \1/g  " 順序を入れ替え
```

### 間違い3: 範囲指定の誤解

**症状**: 意図しない範囲で置換が実行される

**原因**: 範囲指定の記法を間違えている

**解決方法**:
```vim
" 間違い
:1-10s/old/new/g     " 範囲指定が無効

" 正しい
:1,10s/old/new/g     " カンマで範囲指定
:.,$s/old/new/g      " 現在行からファイル末尾
:'<,'>s/old/new/g    " ビジュアル選択範囲
```

### 間違い4: 大文字小文字の設定忘れ

**症状**: 検索で見つからない、または余計なものも検索される

**原因**: ignorecase/smartcase設定を理解していない

**解決方法**:
```vim
" 設定確認
:set ignorecase?     " 現在の設定を確認
:set smartcase?

" 一時的な制御
/pattern\c          " 大文字小文字を無視
/pattern\C          " 大文字小文字を区別
```

## 効率的なテクニック

### テクニック1: 検索パターンの再利用

最後の検索パターンは自動的に保存されます：

```vim
/function           " 検索実行
:%s//method/g       " 空のパターン = 最後の検索パターンを使用
```

### テクニック2: 検索履歴の活用

```vim
q/                  " 検索履歴ウィンドウを開く
" ↑↓で過去の検索パターンを選択
" Enterで実行、Escで閉じる

" コマンドラインでの履歴
/                   " 検索開始
<C-p>               " 前の検索パターン
<C-n>               " 次の検索パターン
```

### テクニック3: インクリメンタル検索の活用

```vim
:set incsearch       " 入力中に検索結果をプレビュー
:set hlsearch        " 検索結果をハイライト
:nohlsearch         " ハイライトを一時的に消去（:nohでも可）
```

### テクニック4: 複雑な置換の段階的実行

複雑な置換は段階的に行う：

```vim
" 1段階目：まず検索で確認
/\(function\)\s\+\(\w\+\)

" 2段階目：小さな範囲でテスト
:1,5s//const \2 =/gc

" 3段階目：全体に適用
:%s//const \2 =/g
```

### テクニック5: ビジュアルモードとの組み合わせ

```vim
" 関数全体を選択して置換
V}                  " 関数ブロックを行選択
:s/old/new/g        " 選択範囲内で置換

" 矩形選択での一括編集
<C-v>               " 矩形選択開始
4j                  " 4行選択
I//                 " 行頭にコメント追加
<Esc>               " 全行に適用
```

## 実践的なパターン集

### よく使う検索パターン

#### プログラミング関連

```vim
" 関数定義
/^function\s\+\w\+\s*(
/^\s*\(function\|const\|let\)\s\+\w\+

" 変数宣言
/\(var\|let\|const\)\s\+\w\+

" クラス定義
/^class\s\+\w\+

" インポート文
/^import\s\+.*from

" TODO/FIXME
/\(TODO\|FIXME\|HACK\|NOTE\)

" コンソール出力
/console\.\(log\|error\|debug\|info\|warn\)

" エラーハンドリング
/\(try\|catch\|throw\|error\|exception\)
```

#### データ形式

```vim
" メールアドレス
/[a-zA-Z0-9._%+-]\+@[a-zA-Z0-9.-]\+\.[a-zA-Z]\{2,\}

" URL
/https\?:\/\/[^\s]\+

" 電話番号（US形式）
/\d\{3\}-\d\{3\}-\d\{4\}

" 日付（YYYY-MM-DD）
/\d\{4\}-\d\{2\}-\d\{2\}

" IPアドレス
/\d\{1,3\}\.\d\{1,3\}\.\d\{1,3\}\.\d\{1,3\}
```

### よく使う置換パターン

#### コード変換

```vim
" var → const
:%s/\<var\>/const/g

" 関数 → アロー関数
:%s/function \(\w\+\)(\([^)]*\))/const \1 = (\2) =>/g

" ダブルクォート → シングルクォート  
:%s/"\([^"]*\)"/'\1'/g

" console.log → logger.info
:%s/console\.log/logger.info/g

" setTimeout → setInterval（例：特定の文脈で）
:%s/setTimeout(\(.*\), \(\d\+\))/setInterval(\1, \2)/g
```

#### 書式統一

```vim
" 行末の空白削除
:%s/\s\+$//g

" 複数の空行を1つに
:%s/\n\n\+/\r\r/g

" タブをスペースに変換
:%s/\t/    /g

" スペースをタブに変換
:%s/    /\t/g
```

### 高度なテクニック

#### 1. 条件付き置換

```vim
" 特定の行でのみ置換（例：コメント行以外）
:%s/\(^\s*[^/]\).*\zs\<old\>/new/g

" 特定の文字列を含む行でのみ置換
:g/pattern/s/old/new/g
```

#### 2. 複数パターンの一括処理

```vim
" マクロを使った繰り返し処理
qq                  " マクロ記録開始
/pattern<Enter>     " 検索
cwreplacement<Esc>  " 置換
q                   " マクロ記録終了
100@q              " 100回実行
```

#### 3. 検索結果でのナビゲーション

```vim
" 検索結果をQuickfixリストに
:vimgrep /pattern/gj %
:copen              " QuickFixウィンドウを開く
:cnext              " 次の結果へ
:cprev              " 前の結果へ
```

## トラブルシューティング

### Q: 正規表現が効かない
A: Vimの正規表現は独特です。`\v`（very magic）モードを使うと標準的：
```vim
/\v(function|const)\s+\w+    " very magicモード
```

### Q: 置換で文字化けする
A: 改行文字の扱いに注意：
```vim
:%s/pattern/replacement\r/g   " \rが改行
:%s/\n/\r/g                   " \nを\rに変換
```

### Q: 検索がヒットしない
A: ファイル全体を検索しているか確認：
```vim
gg                  " ファイル先頭に移動
/pattern            " 最初から検索
```

### Q: 置換が多すぎる
A: 単語境界を使用：
```vim
:%s/\<word\>/replacement/g    " 完全一致のみ
```

## パフォーマンス向上のコツ

### 1. 効率的な検索順序

1. まず大まかなパターンで検索
2. 結果を絞り込み
3. 正確なパターンで最終検索

### 2. 置換前の確認習慣

```vim
" 1. 検索で対象を確認
/pattern

" 2. 小範囲でテスト
:1,10s//replacement/gc

" 3. 全体に適用
:%s//replacement/g
```

### 3. 検索設定の最適化

```vim
:set hlsearch incsearch    " 視覚的フィードバック
:set ignorecase smartcase  " 柔軟な大文字小文字処理
```

これらのテクニックをマスターすることで、大規模なコードベースでも効率的に検索・置換作業ができるようになります！