# 検索と置換 操作ガイド

## 概要

Vimの検索と置換機能は、効率的なコード編集の基盤となります。単純なテキスト検索から、正規表現を使った複雑なパターンマッチまで、様々な場面で活用できる強力な機能です。

## 基本概念

### 検索の種類

Vimには複数の検索方法があり、それぞれ異なる用途に適しています：

1. **パターン検索** (`/`, `?`) - 任意のテキストや正規表現で検索
2. **単語検索** (`*`, `#`) - カーソル下の単語を検索
3. **文字検索** (`f`, `t`) - 行内の特定文字への移動（前レッスンで学習済み）
4. **置換** (`:s`) - 検索と同時にテキストを置き換え

### 検索の方向

- **前方検索** - カーソル位置から下方向に検索
- **後方検索** - カーソル位置から上方向に検索

## 操作方法

### 基本的な検索

#### パターン検索

| コマンド | 説明 | 例 |
|---------|------|-----|
| `/pattern` | 前方検索 | `/function` で"function"を下方向に検索 |
| `?pattern` | 後方検索 | `?return` で"return"を上方向に検索 |
| `n` | 次の検索結果へ | 同じ方向に次のマッチへ移動 |
| `N` | 前の検索結果へ | 逆方向に前のマッチへ移動 |

検索の流れ：
```
1. /pattern<Enter> - 検索実行
2. n - 次へ
3. n - さらに次へ
4. N - 一つ戻る
```

#### 単語検索

| コマンド | 説明 | 使用例 |
|---------|------|--------|
| `*` | カーソル下の単語を前方検索 | 変数名にカーソルを置いて`*` |
| `#` | カーソル下の単語を後方検索 | 関数名にカーソルを置いて`#` |
| `g*` | 部分マッチも含めて前方検索 | "test"が"testing"も検索 |
| `g#` | 部分マッチも含めて後方検索 | "get"が"getUser"も検索 |

### 置換操作

#### 基本的な置換

置換コマンドの基本構文：
```
:[範囲]s/検索パターン/置換文字列/[フラグ]
```

| 置換コマンド | 説明 | 例 |
|-------------|------|-----|
| `:s/old/new/` | 現在行の最初のマッチを置換 | `:s/var/const/` |
| `:s/old/new/g` | 現在行のすべてのマッチを置換 | `:s/old/new/g` |
| `:%s/old/new/g` | ファイル全体のすべてのマッチを置換 | `:%s/var/const/g` |
| `:%s/old/new/gc` | 確認しながら置換 | `:%s/function/method/gc` |

#### 範囲指定

| 範囲 | 説明 | 例 |
|------|------|-----|
| `:s` | 現在行のみ | `:s/old/new/` |
| `:%s` | ファイル全体 | `:%s/old/new/` |
| `:1,10s` | 1行目から10行目 | `:1,10s/old/new/` |
| `:.,$s` | 現在行からファイル末尾 | `:.,$s/old/new/` |
| `:'<,'>s` | ビジュアル選択範囲 | 選択後に`:s/old/new/` |

#### 置換フラグ

| フラグ | 説明 | 使用例 |
|--------|------|--------|
| `g` | 行内のすべてのマッチを置換 | `/g` |
| `c` | 各置換の前に確認 | `/gc` |
| `i` | 大文字小文字を無視 | `/gi` |
| `I` | 大文字小文字を区別 | `/gI` |

確認オプション（c）での操作：
- `y` - この箇所を置換
- `n` - この箇所をスキップ
- `a` - 残り全て置換
- `q` - 置換を中止
- `l` - この箇所を置換して終了

### 正規表現パターン

#### 基本的なメタ文字

| パターン | 説明 | 例 |
|---------|------|-----|
| `.` | 任意の1文字 | `c.t` は "cat", "cut", "c9t" にマッチ |
| `*` | 直前の文字の0回以上の繰り返し | `ca*t` は "ct", "cat", "caat" にマッチ |
| `^` | 行の始まり | `^function` は行頭の"function"のみ |
| `$` | 行の終わり | `;$` は行末のセミコロンのみ |
| `\+` | 直前の文字の1回以上の繰り返し | `ca\+t` は "cat", "caat" にマッチ（"ct"は除く） |
| `\?` | 直前の文字の0回または1回 | `colou\?r` は "color", "colour" にマッチ |

#### 文字クラス

| パターン | 説明 | 例 |
|---------|------|-----|
| `[abc]` | a, b, c のいずれか | `[aeiou]` は母音にマッチ |
| `[^abc]` | a, b, c 以外 | `[^0-9]` は数字以外にマッチ |
| `[a-z]` | 範囲指定 | `[0-9]` は数字、`[A-Z]` は大文字 |
| `\d` | 数字 | `\d\+` は1つ以上の数字 |
| `\w` | 単語文字（英数字とアンダースコア） | `\w\+` は単語にマッチ |
| `\s` | 空白文字 | `\s\+` は1つ以上の空白 |

#### グループ化と後方参照

| パターン | 説明 | 例 |
|---------|------|-----|
| `\(pattern\)` | グループ化 | `\(function\)\s\+\(\w\+\)` |
| `\1`, `\2` | 後方参照 | 置換で `\1` は最初のグループを参照 |

例：関数名をキャメルケースに変換
```
検索: \(function\)\s\+\([a-z_]\+\)
置換: \1 \U\2
```

### 実践的な検索パターン

#### コード検索の典型例

1. **関数定義の検索**
```vim
/^function\s\+\w\+     " 関数定義行
/^\s*function          " インデントされた関数
```

2. **変数宣言の検索**
```vim
/\(var\|let\|const\)\s\+\w\+    " 変数宣言
/\<userId\>                     " 単語境界つき変数名
```

3. **コメントの検索**
```vim
/\/\/.*TODO            " TODOコメント
/\/\*.*\*\/            " ブロックコメント
```

4. **エラー処理の検索**
```vim
/catch\|throw\|error   " エラー関連キーワード
/console\.error        " エラーログ
```

### 検索履歴

| コマンド | 説明 |
|---------|------|
| `/` + `↑` | 検索履歴を遡る |
| `/` + `↓` | 検索履歴を進む |
| `q/` | 検索履歴ウィンドウを開く |
| `q?` | 後方検索履歴ウィンドウを開く |

### 便利な検索オプション

#### 検索設定

```vim
:set hlsearch          " 検索結果をハイライト
:set incsearch         " インクリメンタル検索（入力中に検索）
:set ignorecase        " 大文字小文字を無視
:set smartcase         " 大文字が含まれる場合は区別

:nohlsearch           " ハイライトを一時的に無効（:noh でも可）
```

## 実践例

### 例1: ログレベルの変更

```javascript
// 変更前
console.log("Debug info");
console.log("User data:", userData);
console.log("Processing...");

// 置換: :%s/console\.log/console.debug/g
// 変更後  
console.debug("Debug info");
console.debug("User data:", userData);
console.debug("Processing...");
```

### 例2: 関数をアロー関数に変換

```javascript
// 変更前
function calculateTotal(items) {
    return items.reduce((sum, item) => sum + item.price, 0);
}

// 置換: :%s/function \(\w\+\)(\(.*\))/const \1 = (\2) =>/
// 変更後
const calculateTotal = (items) => {
    return items.reduce((sum, item) => sum + item.price, 0);
}
```

### 例3: インポート文の整理

```javascript
// 統一前
import { Component } from 'react';
import {useState} from 'react';
import { useEffect } from 'react';

// 置換: :%s/import\s*{\s*\([^}]\+\)\s*}\s*from\s*'react'/import { \1 } from 'react'/
// 統一後
import { Component } from 'react';
import { useState } from 'react';
import { useEffect } from 'react';
```

## 高度なテクニック

### 1. 複数の検索パターンの組み合わせ

```vim
/\(error\|exception\|fail\)    " いずれかのキーワード
/function.*\(async\|await\)    " async関数
```

### 2. 検索と編集の組み合わせ

```vim
/pattern                       " パターンを検索
cgn new_text<ESC>             " 見つかった部分を置換
.                             " 次の箇所も同様に置換
```

### 3. ビジュアルモードでの置換

```vim
v/pattern<Enter>              " パターンまで選択
:s/old/new/                   " 選択範囲内で置換
```

## まとめ

このレッスンで学んだ重要なポイント：

- **基本検索**: `/`, `?` による前方・後方検索
- **単語検索**: `*`, `#` による効率的な変数・関数名検索
- **置換操作**: `:s` による基本置換から `:%s/old/new/gc` による安全な一括置換
- **正規表現**: メタ文字、文字クラス、グループ化による柔軟なパターンマッチ
- **実践テクニック**: コード特有の検索パターンと効率的なワークフロー

これらの検索・置換技術をマスターすることで、大きなコードベースでの開発効率が大幅に向上します。