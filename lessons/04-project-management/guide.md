# ファイル・ウィンドウ操作 操作ガイド

## 概要

Neovimでの効率的な開発では、バッファ、ウィンドウ、タブという3つの概念を理解することが重要です。
これらを適切に使い分けることで、複数ファイルでの作業を快適に行えます。

## 基本概念

### バッファ（Buffer）

**バッファ**は、メモリ上に読み込まれたファイルの内容です。

- ファイルを開くとバッファが作成される
- バッファはウィンドウに表示されていなくても存在する
- 1つのバッファを複数のウィンドウで表示可能
- 変更はバッファに対して行われる

### ウィンドウ（Window）

**ウィンドウ**は、バッファを表示する画面領域です。

- 1つの画面を分割して複数のウィンドウを作成可能
- 各ウィンドウは1つのバッファを表示
- 同じバッファを複数のウィンドウで表示可能
- ウィンドウを閉じてもバッファは残る

### タブ（Tab）

**タブ**は、ウィンドウのレイアウトをグループ化したものです。

- 1つのタブに複数のウィンドウを配置
- タブ間でウィンドウレイアウトを切り替え
- プロジェクトや作業内容別にタブを使い分け

### 概念図

```
タブ1                          タブ2
┌─────────────────────────┐    ┌─────────────────────────┐
│ウィンドウ1    │ウィンドウ2│    │ウィンドウ3              │
│(バッファA)    │(バッファB)│    │(バッファC)              │
│              │          │    │                        │
├──────────────┴──────────┤    └─────────────────────────┘
│ウィンドウ3               │
│(バッファC)               │
└─────────────────────────┘
```

## 操作方法

### バッファ操作

#### バッファの開閉

| コマンド | 説明 | 例 |
|---------|------|-----|
| `:e filename` | ファイルを開く | `:e main.js` |
| `:enew` | 新しい空のバッファを作成 | 新規ファイル作成時 |
| `:bd` | 現在のバッファを削除 | ファイルを閉じる |
| `:bd!` | 未保存でもバッファを強制削除 | 変更を破棄して閉じる |
| `:w` | バッファを保存 | ファイル保存 |
| `:wa` | すべてのバッファを保存 | 全ファイル保存 |

#### バッファ間の移動

| コマンド | 説明 | 使用場面 |
|---------|------|----------|
| `:bnext` or `:bn` | 次のバッファへ | バッファを順番に確認 |
| `:bprev` or `:bp` | 前のバッファへ | 直前のバッファに戻る |
| `:bfirst` | 最初のバッファへ | バッファリストの先頭 |
| `:blast` | 最後のバッファへ | バッファリストの末尾 |
| `:b filename` | ファイル名でバッファに移動 | `:b main` で main.js に移動 |
| `:b#` | 直前のバッファに移動 | Alt+Tabのような切り替え |

#### バッファリストの確認

| コマンド | 説明 | 表示内容 |
|---------|------|----------|
| `:ls` or `:buffers` | バッファリストを表示 | 番号、状態、ファイル名 |
| `:ls!` | 削除されたバッファも表示 | 非表示バッファも含む |

バッファリスト表示例：
```
1 #h   "main.js"                     line 15
2 %a   "utils.js"                    line 8
3      "config.json"                 line 1
```

表示記号の意味：
- `%` : 現在のウィンドウのバッファ
- `#` : 直前のバッファ
- `a` : アクティブ（表示中）
- `h` : 非表示

### ウィンドウ操作

#### ウィンドウの分割

| コマンド | 説明 | レイアウト |
|---------|------|----------|
| `:split` or `:sp` | 水平分割 | 上下に分割 |
| `:vsplit` or `:vsp` | 垂直分割 | 左右に分割 |
| `:sp filename` | ファイルを水平分割で開く | 指定ファイルを上下で表示 |
| `:vsp filename` | ファイルを垂直分割で開く | 指定ファイルを左右で表示 |

#### ウィンドウ間の移動

| コマンド | 説明 | 使用例 |
|---------|------|--------|
| `Ctrl-w h` | 左のウィンドウへ | 左ペインに移動 |
| `Ctrl-w j` | 下のウィンドウへ | 下ペインに移動 |
| `Ctrl-w k` | 上のウィンドウへ | 上ペインに移動 |
| `Ctrl-w l` | 右のウィンドウへ | 右ペインに移動 |
| `Ctrl-w w` | 次のウィンドウへ | 順番に移動 |
| `Ctrl-w p` | 直前のウィンドウへ | 最後にいたウィンドウ |

#### ウィンドウサイズの調整

| コマンド | 説明 | 効果 |
|---------|------|------|
| `Ctrl-w +` | ウィンドウの高さを増加 | 現在のウィンドウが高くなる |
| `Ctrl-w -` | ウィンドウの高さを減少 | 現在のウィンドウが低くなる |
| `Ctrl-w >` | ウィンドウの幅を増加 | 現在のウィンドウが広くなる |
| `Ctrl-w <` | ウィンドウの幅を減少 | 現在のウィンドウが狭くなる |
| `Ctrl-w =` | すべてのウィンドウを等サイズに | バランスよく配置 |
| `:resize 20` | ウィンドウの高さを20行に設定 | 絶対値指定 |
| `:vertical resize 80` | ウィンドウの幅を80文字に設定 | 絶対値指定 |

#### ウィンドウの操作

| コマンド | 説明 | 結果 |
|---------|------|------|
| `Ctrl-w c` | 現在のウィンドウを閉じる | バッファは残る |
| `Ctrl-w o` | 現在のウィンドウ以外を閉じる | フォーカスしたウィンドウのみ |
| `Ctrl-w s` | 現在のウィンドウを水平分割 | `:split`と同じ |
| `Ctrl-w v` | 現在のウィンドウを垂直分割 | `:vsplit`と同じ |

### タブ操作

#### タブの作成・移動

| コマンド | 説明 | 使用場面 |
|---------|------|----------|
| `:tabnew` | 新しいタブを作成 | 新しい作業エリア |
| `:tabnew filename` | ファイルを新しいタブで開く | ファイルを別タブで表示 |
| `:tabnext` or `gt` | 次のタブへ移動 | タブ切り替え |
| `:tabprev` or `gT` | 前のタブへ移動 | タブ切り替え |
| `:tabfirst` | 最初のタブへ移動 | タブリストの先頭 |
| `:tablast` | 最後のタブへ移動 | タブリストの末尾 |
| `{count}gt` | 指定番号のタブへ移動 | `3gt`で3番目のタブ |

#### タブの管理

| コマンド | 説明 | 効果 |
|---------|------|------|
| `:tabclose` | 現在のタブを閉じる | タブとそのウィンドウを閉じる |
| `:tabonly` | 現在のタブ以外を閉じる | アクティブタブのみ残す |
| `:tabs` | タブリストを表示 | 開いているタブの一覧 |

### ファイルエクスプローラ

#### Netrw（内蔵エクスプローラ）

| コマンド | 説明 | 使用例 |
|---------|------|--------|
| `:Ex` | カレントディレクトリを開く | ファイル一覧表示 |
| `:Sex` | 水平分割でエクスプローラ | 上下分割でファイル選択 |
| `:Vex` | 垂直分割でエクスプローラ | 左右分割でファイル選択 |

Netrwでの操作：
- `Enter` : ファイル/ディレクトリを開く
- `-` : 親ディレクトリに移動
- `d` : 新しいディレクトリ作成
- `%` : 新しいファイル作成
- `D` : ファイル/ディレクトリ削除
- `R` : ファイル/ディレクトリ名前変更

### 実践的なファイル操作

#### ファイルを開く様々な方法

```vim
" 基本的な開き方
:e path/to/file.js

" ワイルドカードを使用
:e *.js                    " JavaScriptファイルを選択
:e **/*.test.js           " テストファイルを再帰検索

" カレントディレクトリ変更
:cd /path/to/project      " ワーキングディレクトリ変更
:lcd /path/to/project     " ローカルディレクトリ変更（ウィンドウ固有）

" ファイルパスの補完
:e src/<Tab>              " Tabで補完
:e src/**/<Tab>           " 再帰的な補完
```

#### 複数ファイルの一括操作

```vim
" 複数ファイルを同時に開く
nvim file1.js file2.js file3.js

" 引数リストの操作
:args *.js                " JavaScriptファイルを引数リストに
:argdo %s/old/new/ge      " 全ファイルで置換
:argdo update             " 全ファイルを保存

" バッファで一括操作
:bufdo %s/old/new/ge      " 全バッファで置換
:wall                     " 全バッファを保存
```

## 実践的なワークフロー

### ワークフロー1: デバッグ作業

```vim
" 1. メインファイルを開く
:e src/main.js

" 2. ログファイルを水平分割で開く
:sp logs/debug.log

" 3. 設定ファイルを垂直分割で開く
:vsp config/app.json

" 4. ウィンドウ間を移動しながら作業
Ctrl-w h                  " 設定ファイルに移動
Ctrl-w j                  " ログファイルに移動
Ctrl-w k                  " メインファイルに移動
```

### ワークフロー2: リファクタリング作業

```vim
" 1. 関連ファイルをタブで整理
:tabnew                   " 新しいタブ作成
:e src/utils.js           " ユーティリティファイル
:vsp tests/utils.test.js  " テストファイルを分割表示

" 2. 別タブで設定ファイル
:tabnew config/           " 設定用タブ
:vsp package.json         " 依存関係確認

" 3. タブ間を移動しながら作業
gt                        " 次のタブ
gT                        " 前のタブ
```

### ワークフロー3: 新機能開発

```vim
" 1. 機能別にタブを作成
:tabnew                   " 機能開発タブ
:e src/components/NewFeature.js
:sp src/hooks/useNewFeature.js

" 2. テスト用タブ
:tabnew                   " テストタブ  
:e tests/NewFeature.test.js
:sp tests/integration/newFeature.spec.js

" 3. ドキュメント用タブ
:tabnew                   " ドキュメントタブ
:e README.md
:sp docs/features/new-feature.md
```

## 便利なコマンド組み合わせ

### ファイル比較

```vim
" 2つのファイルを並べて比較
:e file1.js
:vsp file2.js
Ctrl-w h                  " 左ウィンドウに移動
:diffthis                 " diff mode開始
Ctrl-w l                  " 右ウィンドウに移動  
:diffthis                 " diff mode開始
```

### 検索結果でのファイル移動

```vim
" grep結果をquickfixで開く
:grep "function" *.js
:copen                    " quickfixウィンドウを開く
:cnext                    " 次の結果に移動
:cprev                    " 前の結果に移動
```

### セッション管理

```vim
" セッションの保存・復元
:mksession! project.vim   " セッション保存
:source project.vim       " セッション復元

" 自動セッション（.vimrcに設定）
set sessionoptions=buffers,winpos,resize,tabpages
```

## まとめ

このレッスンで学んだ重要なポイント：

- **概念理解**: バッファ・ウィンドウ・タブの違いと使い分け
- **バッファ操作**: `:ls`, `:bn`, `:bp` による効率的なファイル切り替え
- **ウィンドウ分割**: `:split`, `:vsplit` と `Ctrl-w` による画面分割
- **タブ管理**: `gt`, `gT`, `:tabnew` による作業エリアの整理
- **実践ワークフロー**: デバッグ、リファクタリング、開発での活用法

これらの操作を組み合わせることで、複雑なプロジェクトでも効率的に開発作業を進められるようになります。