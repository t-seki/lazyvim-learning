# Text Object - ヒントとトラブルシューティング

## よくある疑問と解決策

### Q: Text Objectが期待通りに動作しない

**A: 以下を確認してください：**

1. **カーソル位置**: Text Objectは現在のカーソル位置を基準に動作します
   ```vim
   " 例：引用符の外側にカーソルがある場合
   hello "world" here
   ^カーソル
   " ci" は動作しません。引用符内に移動する必要があります
   ```

2. **プラグインの有効化**: Treesitter Text Objectsが有効か確認
   ```vim
   :TSInstallInfo
   " 言語のパーサーがインストールされているか確認
   ```

3. **ビジュアルモードとの混同**: Text Objectはオペレータと組み合わせて使用
   ```vim
   " 正しい: daw (delete around word)
   " 間違い: vdaw (vは不要)
   ```

### Q: `i`と`a`の使い分けがわからない

**A: 簡単な覚え方：**

- `i` = **inner**（内側だけ）
- `a` = **around**（周囲も含む）

```vim
"Hello, World!"
       ^カーソル
ci" → "" (引用符は残る)
ca" → （引用符ごと削除されるので、カーソル位置が変わる）
```

### Q: Treesitter Text Objectsが使えない

**A: LazyVimでの設定確認：**

1. `:Lazy`でプラグイン状態を確認
2. 必要な言語のTreesitterパーサーをインストール：
   ```vim
   :TSInstall python lua javascript
   ```

3. 設定ファイルで有効化されているか確認：
   ```lua
   -- ~/.config/nvim/lua/plugins/treesitter.lua
   return {
     {
       "nvim-treesitter/nvim-treesitter-textobjects",
       enabled = true,
     }
   }
   ```

## 効率的な使い方のコツ

### 1. よく使うパターンを覚える

最頻出パターン：
- `ciw` - 単語を変更
- `di"` / `di'` - 文字列内容を削除
- `da(` - 関数の引数を括弧ごと削除
- `vip` - 段落を選択
- `cit` - HTMLタグの内容を変更

### 2. 繰り返しとドットコマンド

```vim
" 最初の操作
ci"new content<Esc>

" 次の引用符に移動して
f"

" ドットで繰り返し
.
```

### 3. カウントとの組み合わせ

```vim
" 2つ目の引用符内を変更
2ci"

" 3つの単語を削除
d3aw
```

### 4. マクロとの組み合わせ

```vim
" qを押してマクロ記録開始
qa
" Text Object操作を記録
ci"REPLACED<Esc>
" qで記録終了
q

" @aでマクロ実行
```

## パフォーマンス向上のヒント

### 1. ビジュアルモードより直接操作

```vim
" 非効率: viwx
" 効率的: diw
```

### 2. 適切なText Objectの選択

```vim
" 関数名を変更する場合
" 非効率: f(Bce (モーションで移動して変更)
" 効率的: cif (function text objectを使用)
```

### 3. 検索と組み合わせ

```vim
" 特定の文字列を含む段落を削除
/error<CR>
dap
```

## トラブルシューティング

### 括弧やクォートのペアが見つからない

**症状**: `di(`や`di"`が動作しない

**解決策**:
1. 対応する閉じ括弧/クォートが存在するか確認
2. ネストが正しいか確認
3. エスケープされた文字に注意

### Text Objectの範囲が予想と異なる

**症状**: 選択範囲が大きすぎる/小さすぎる

**解決策**:
1. ファイルタイプ固有の設定を確認
2. インデントが正しいか確認（特にPython）
3. 言語サーバーが正しく動作しているか確認

### カスタムText Objectが動作しない

**症状**: 追加したText Objectが認識されない

**解決策**:
```lua
-- 設定が正しく読み込まれているか確認
:lua print(vim.inspect(vim.fn.getmaplist()))
```

## 練習を効果的にする方法

### 1. 段階的な練習

1. 基本Text Object（`iw`, `i"`, `i(`）を完璧に
2. 次に`a`バリエーションを追加
3. Treesitter Text Objectsへ進む
4. カスタムText Objectsを試す

### 2. 実際のコードで練習

自分のプロジェクトで：
- リファクタリング時に意識的に使用
- コードレビュー時にText Objectで移動
- ペアプログラミングでデモンストレーション

### 3. 計測して改善

```vim
" 操作前
:set showcmd  " コマンドを表示

" 操作時間を意識
" 同じ編集を異なる方法で試して比較
```

## 上級テクニック

### Text Objectの拡張

```vim
" ビジュアルモードでText Objectを拡張
vi"  " 最初の選択
a"   " 選択を拡張（引用符を含める）
```

### オペレータ保留モード

```vim
" dを押した後、考える時間がある
d    " オペレータ保留モード
     " ここで考えてもOK
iw   " Text Objectを決定
```

### 独自のワークフロー構築

1. 自分がよく行う編集パターンを特定
2. そのパターンに最適なText Objectを選択
3. 必要に応じてカスタマイズ

## まとめ

Text Objectの習得は段階的なプロセスです：

1. **最初の1週間**: 基本的な5-6個を意識的に使用
2. **2-3週間後**: 自然に使えるようになる
3. **1ヶ月後**: 複雑な編集も直感的に

継続的な練習が鍵です。毎日のコーディングで意識的に使用することで、必ず身につきます。